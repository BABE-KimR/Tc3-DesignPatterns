Full implementation of the command design pattern

Possible additions
* trail auditing
* undo
